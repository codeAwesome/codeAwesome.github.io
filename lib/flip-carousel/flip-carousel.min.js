$.fn.flipcarousel=function(e){function w(){var e=$("<li>"),a=$("<ul>");for(r.css({"-webkit-transition-duration":t.duration+"ms","-moz-transition-duration":t.duration+"ms","-ms-transition-duration":t.duration+"ms","transition-duration":t.duration+"ms"}),i.append(a),r.append(o),e.append(r),c=0;c<t.itemsperpage;c++)a.append(e.clone());n.click(function(){b||x(u+1)}),l.click(function(){b||x(u-1)}),s.append(l).append(n),i.append(s).append(d),i.insertBefore(m[0]),r=$(".card"),m.remove()}function _(e,a){function o(t){r++,t&&e.find('img[src="'+t.attr("src")+'"]').addClass("err"),r==i.length&&(a(e),d.addClass("hide"))}t.loader&&d.removeClass("hide");var i=[],r=0;e.find("img").each(function(e){i.push("yah!"),img=new Image,img.onload=function(){o(null)},img.onerror=function(){o($(this))},img.src=$(this).attr("src")}),i.length||(d.addClass("hide"),a(e))}function C(e,a){for(c=0;c<t.itemsperpage;c++){var i=e[c]||'<div class="empty"></div>';r.eq(c).find(a).html($(i).clone())}}function x(e){T(e),g=".front"==g?".back":".front",$(".back, .front").css({"z-index":0}),r.find(g).css({"z-index":1}),C(y[e],g),e>u?v+=180:u>e&&(v-=180),b=!0,L(v,function(){e>u&&y[e+1]?_(y[e+1],function(e){b=!1}):b=!1,u=e})}function T(e){n.add(l).removeClass("hide"),0==e&&l.addClass("hide"),e==y.length-1&&n.addClass("hide")}function L(e,a){t.randomizer&&R(),r.css({"-webkit-transform":"rotateY("+e+"deg)","-moz-transform":"rotateY("+e+"deg)"}),a&&setTimeout(a,t.duration)}function M(e){for(var a,t,i=e.length;i;a=parseInt(Math.random()*i),t=e[--i],e[i]=e[a],e[a]=t);return e}function R(){var e=[],i=[];for(a=1;a<=t.itemsperpage;a++){var o=a/t.itemsperpage%2;o=Math.floor(o*t.randomizer*t.duration/2),e.push(o),o=a/2%1==0?-o:o,i.push(t.duration+o)}e=M(e),r.each(function(a){$(this).css({"-webkit-transition-delay":e[a]+"ms","-moz-transition-delay":e[a]+"ms","-ms-transition-delay":e[a]+"ms","transition-delay":e[a]+"ms"})}),i=M(i),r.each(function(e){$(this).css({"-webkit-transition-duration":i[e]+"ms","-moz-transition-duration":i[e]+"ms","-ms-transition-duration":i[e]+"ms","transition-duration":i[e]+"ms"})})}function F(){w();var e=y[1]?$.merge(y[0],y[1]):y[0];_(e,function(e){C(e.slice(0,t.itemsperpage),".front"),C(e.slice(t.itemsperpage,2*t.itemsperpage),".back"),b=!1,T(0),L(0)})}var t=$.extend({itemsperpage:3,duration:500,randomizer:0,loader:!1,arrows:!0},e),i=$('<div class="flip-carousel">'),r=$('<div class="card">'),o=$('<div class="face front"></div><div class="face back"></div>'),s=$('<div class="controls">'),n=$('<div class="arrow right">'),l=$('<div class="arrow left hide">'),d=$('<div class="loader hide">'),m=this,f=this.clone(),u=($(this).parent(),0),g=".front",v=0,b=!0,y=[];for(p=0;p<Math.ceil(f.length/t.itemsperpage);p++){var k=t.itemsperpage*p;y[p]=f.slice(k,k+t.itemsperpage)}return F(),this};